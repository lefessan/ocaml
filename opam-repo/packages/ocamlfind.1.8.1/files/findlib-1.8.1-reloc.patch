diff -r -u -w findlib-1.8.1.orig/configure findlib-1.8.1.reloc/configure
--- findlib-1.8.1.orig/configure	2019-07-29 14:06:34.000000000 +0200
+++ findlib-1.8.1.reloc/configure	2020-06-23 17:45:47.100833172 +0200
@@ -113,6 +113,7 @@
 ocamlfind_bin=""
 ocamlfind_man=""
 ocaml_sitelib=""
+ocaml_sitelib2=""
 ocamlfind_config=""
 with_toolbox=0
 with_topfind=1
@@ -132,6 +133,9 @@
         -sitelib) ocaml_sitelib=$2
 	          shift 2
 		  ;;
+        -sitelib2) ocaml_sitelib2=$2
+	          shift 2
+		  ;;
         -config) ocamlfind_config=$2
 	         shift 2
 		 ;;
@@ -278,6 +282,10 @@
     esac
 fi
 
+if [ -z "$ocaml_sitelib2" ]; then
+    ocaml_sitelib2="${ocaml_sitelib}"
+fi
+
 # Find out the directory where ocamlc is:
 
 ocamlc=`get_path ocamlc`
@@ -643,6 +651,7 @@
 echo "OCAML_CORE_BIN=${ocaml_core_bin}" >>Makefile.config
 echo "OCAML_CORE_MAN=${ocaml_core_man}" >>Makefile.config
 echo "OCAML_SITELIB=${ocaml_sitelib}" >>Makefile.config
+echo "OCAML_SITELIB2=${ocaml_sitelib2}" >>Makefile.config
 echo "OCAML_THREADS=${ocaml_threads}" >>Makefile.config
 echo "OCAMLFIND_BIN=${ocamlfind_bin}" >>Makefile.config
 echo "OCAMLFIND_MAN=${ocamlfind_man}" >>Makefile.config
diff -r -u -w findlib-1.8.1.orig/Makefile findlib-1.8.1.reloc/Makefile
--- findlib-1.8.1.orig/Makefile	2019-07-29 14:06:34.000000000 +0200
+++ findlib-1.8.1.reloc/Makefile	2020-06-23 17:48:02.332760090 +0200
@@ -55,7 +55,7 @@
 	USE_CYGPATH="$(USE_CYGPATH)"; \
 	export USE_CYGPATH; \
 	cat findlib.conf.in | \
-	    $(SH) tools/patch '@SITELIB@' '$(OCAML_SITELIB)' >findlib.conf
+	    $(SH) tools/patch '@SITELIB@' '$(OCAML_SITELIB2)' >findlib.conf
 	if ./tools/cmd_from_same_dir ocamlc; then \
 		echo 'ocamlc="ocamlc.opt"' >>findlib.conf; \
 	fi
diff -r -u -w findlib-1.8.1.orig/src/findlib/findlib_config.mlp findlib-1.8.1.reloc/src/findlib/findlib_config.mlp
--- findlib-1.8.1.orig/src/findlib/findlib_config.mlp	2019-07-29 14:06:34.000000000 +0200
+++ findlib-1.8.1.reloc/src/findlib/findlib_config.mlp	2020-06-23 18:08:31.807897144 +0200
@@ -3,9 +3,12 @@
  *
  *)
 
-let config_file = "@CONFIGFILE@";;
-
-let ocaml_stdlib = "@STDLIB@";;
+let ( config_file, ocaml_stdlib) =
+  match Sys.getenv "OPAM_SWITCH_PREFIX" with
+  | exception Not_found -> ( "@CONFIGFILE@", "@STDLIB@" )
+  | opam_switch_prefix ->
+    ( Filename.concat opam_switch_prefix "lib/findlib.conf",
+      Filename.concat opam_switch_prefix "lib/ocaml" )
 
 let ocaml_ldconf = Filename.concat ocaml_stdlib "ld.conf";;
 
diff -r -u -w findlib-1.8.1.orig/src/findlib/findlib.ml findlib-1.8.1.reloc/src/findlib/findlib.ml
--- findlib-1.8.1.orig/src/findlib/findlib.ml	2019-07-29 14:06:35.000000000 +0200
+++ findlib-1.8.1.reloc/src/findlib/findlib.ml	2020-06-23 18:19:49.335260718 +0200
@@ -111,6 +111,19 @@
     ( try Sys.getenv "OCAMLFIND_CONF" with Not_found -> "") in
   if p = "" then Findlib_config.config_file else p
                                                    
+let ocaml_in_opam = match Sys.getenv "OPAM_SWITCH_PREFIX" with
+  | exception Not_found -> None
+  | s -> Some ( Filename.concat s "lib/ocaml" )
+
+let in_opam dir =
+  let len = String.length dir in
+  if len > 0 && dir.[0] = '+' then
+    match ocaml_in_opam with
+    | None -> failwith "+relative path without OPAM_SWITCH_PREFIX"
+    | Some ocaml_in_opam ->
+      Filename.concat ocaml_in_opam (String.sub dir 1 (len-1))
+  else
+    dir
   
 let init
       ?env_ocamlpath ?env_ocamlfind_destdir ?env_ocamlfind_metadir
@@ -198,8 +211,8 @@
 	    (lookup "ocamldep" ocamldep_default),
 	    (lookup "ocamlbrowser" ocamlbrowser_default),
 	    (lookup "ocamldoc" ocamldoc_default),
-	    Fl_split.path (lookup "path" ""),
-	    (lookup "destdir" ""),
+	    List.map in_opam @@ Fl_split.path (lookup "path" ""),
+	    in_opam (lookup "destdir" ""),
 	    (lookup "metadir" "none"),
 	    (lookup "stdlib" Findlib_config.ocaml_stdlib),
 	    (lookup "ldconf" Findlib_config.ocaml_ldconf)
@@ -521,4 +534,3 @@
 
 let recorded_predicates() =
   !rec_preds
-
diff -r -u -w findlib-1.8.1.orig/src/findlib/frontend.ml findlib-1.8.1.reloc/src/findlib/frontend.ml
--- findlib-1.8.1.orig/src/findlib/frontend.ml	2019-07-29 14:06:35.000000000 +0200
+++ findlib-1.8.1.reloc/src/findlib/frontend.ml	2020-06-23 14:56:14.398578665 +0200
@@ -233,7 +233,17 @@
     while true do
       let line = input_line f in
       if line <> "" then
-	lines := line :: !lines
+        lines :=
+          (if line.[0] = '+' then
+             let line =
+               Filename.concat
+                 (Findlib.ocaml_stdlib ())
+                 (String.sub line 1 ((String.length line) - 1))
+             in
+             Printf.eprintf "ldconf+ %s\n%!" line;
+             line
+           else
+             line) :: !lines
     done;
     assert false
   with
diff -r -u -w findlib-1.8.1.orig/src/findlib/Makefile findlib-1.8.1.reloc/src/findlib/Makefile
--- findlib-1.8.1.orig/src/findlib/Makefile	2019-07-29 14:06:35.000000000 +0200
+++ findlib-1.8.1.reloc/src/findlib/Makefile	2020-06-23 17:46:40.460805369 +0200
@@ -106,7 +106,7 @@
 	USE_CYGPATH="$(USE_CYGPATH)"; \
 	export USE_CYGPATH; \
 	cat topfind_rd$(OCAML_REMOVE_DIRECTORY).p | \
-	        $(SH) $(TOP)/tools/patch '@SITELIB@' '$(OCAML_SITELIB)' \
+	        $(SH) $(TOP)/tools/patch '@SITELIB@' '$(OCAML_SITELIB2)' \
 	    	    >topfind
 
 num_top.cma: $(NUMTOP_OBJECTS)
